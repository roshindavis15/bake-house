<%- include('../layouts/header')%>

		<!-- search area -->
		<div class="search-area">
			<div class="container">
				<div class="row">
					<div class="col-lg-12">
						<span class="close-btn"><i class="fas fa-window-close"></i></span>
						<div class="search-bar">
							<div class="search-bar-tablecell">
								<h3>Search For:</h3>
								<input type="text" placeholder="Keywords">
								<button type="submit">Search <i class="fas fa-search"></i></button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- end search arewa -->
		
		<!-- breadcrumb-section -->
		<div class="breadcrumb-section breadcrumb-bg">
			<div class="container">
				<div class="row">
					<div class="col-lg-8 offset-lg-2 text-center">
						<div class="breadcrumb-text">
							
							<h1>Check Out Product</h1>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- end breadcrumb section -->

		<!-- check out section -->
		<div class="checkout-section mt-150 mb-150">
			<div class="container">
				<div class="row">
					<div class="col-lg-8">
						<div class="checkout-accordion-wrap">
							<div class="accordion" id="accordionExample">
							<div class="card single-accordion">
								<%if(defaultAddress !='undefined'){%>
									
								<div class="card-header" id="headingOne">
								<h5 class="mb-0">
										<button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
										Billing Address
										</button>
								</h5>
								</div>
								
								

								<div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
								<div class="card-body">
									<div class="billing-address-form">
										<form action="index.html">
											<p><input type="text" value="<%=defaultAddress.address[0].name%>" readonly></p>
											<p><input type="tel" value="<%=defaultAddress.address[0].mobile%>" readonly></p>
											<p><input type="text" value="<%=defaultAddress.address[0].homeAddress%>" readonly></p>
											<p><input type="tel" value="<%=defaultAddress.address[0].pincode%>" readonly></p>
										</form>
										
									</div>
									<a href="#" class="boxed-btnn" id="changeAddressButton">Change Address</a>

								</div>
								</div>
							</div>
							<div class="card single-accordion">
								
							
							</div>
							<div class="card single-accordion">
								<div class="card-header" id="headingThree">
								
								</div>
								
							</div>
							</div>
								<%}%>

						</div>
					</div>
					
					<!-- modal for display the other addresses -->

					
<div class="modal" id="addressModal" tabindex="-1" role="dialog">
	<div class="modal-dialog" role="document">
	  <div class="modal-content">
		<div class="modal-header">
		  <h5 class="modal-title">Select an Address</h5>
		  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			<span aria-hidden="true">&times;</span>
		  </button>
		</div>
		<div class="modal-body">
		  <!-- Iterate through filteredAddressess to display the addresses -->
		  <% for (let addresses of filteredAddressess) { %>
			<% if (addresses.length > 0) { %>
			  <div class="address-set">
				<% for (let address of addresses) { %>
				  <div class="address-item">
					<p><strong>Name:</strong> <%= address.name %></p>
					<p><strong>Mobile:</strong> <%= address.mobile %></p>
					<p><strong>Home Address:</strong> <%= address.homeAddress %></p>
					<p><strong>Place:</strong> <%= address.place %></p>
					<p><strong>Pin Code:</strong> <%= address.pincode %></p>
					
					<input type="radio" name="selectedAddress" value="<%= address._id %>">
				  </div>
				<% } %>
			  </div>
			<% } %>
		  <% } %>
		</div>
		<div class="modal-footer">
			<div class="col-md-12">
				<a href="#" class="btn btn-success add-address-button" data-toggle="modal" data-target="#addAddressModal" id="openAddAddressModal">Add Address</a>


			</div>
		  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		  <button type="button" class="btn btn-primary">Save Address</button>
		</div>
	  </div>
	</div>
  </div>

  <!-- Add address modal form -->

  <div class="modal" id="addAddressModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Address</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Your Add Address Form Goes Here -->
                <form action="/addAddressInCheckout" method="POST">
                 <!-- Name Input -->
            <div class="form-input">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required>
            </div>

            <!-- Mobile Input -->
            <div class="form-input">
                <label for="mobile">Mobile:</label>
                <input type="text" id="mobile" name="mobile" required>
            </div>

            <!-- Home Address Input -->
            <div class="form-input">
                <label for="homeAddress">Home Address:</label>
                <input type="text" id="homeAddress" name="homeAddress" required>
            </div>

            <!-- Place Input -->
            <div class="form-input">
                <label for="place">Place:</label>
                <input type="text" id="place" name="place" required>
            </div>

            <!-- Pincode Input -->
            <div class="form-input">
                <label for="pincode">Pincode:</label>
                <input type="text" id="pincode" name="pincode" required>
            </div>

            <!-- Submit Button -->
            <div class="form-input">
                <button type="submit" class="btn btn-primary">Submit</button>
            </div>
                </form>
            </div>
        </div>
    </div>
</div>

  

					<div class="col-lg-4">
						<div class="order-details-wrap">
							<table class="order-details">
								<thead>
									<tr>
										<th>Your order Details</th>
										<th>Price</th>
									</tr>
								</thead>
								<tbody class="order-details-body">
									
									<%if(productDetails != 'undefined'){%>

										<%for(i=0;i<productDetails.length;i++){%>
											
									<tr>
										<td> <%=productDetails[i].productName%></td>
										
										<td><%=productDetails[i].subtotal%></td>
									</tr>
									<%}%>
									<%}%>
									
								</tbody>
								<tbody class="checkout-details">
									<tr>
										<td>Subtotal</td>
										<td><%=cartTotal%></td>

									</tr>
									<% if(coupenData !='undefined' && coupenData.length>0){%>
                                        <%for(i=0;i<coupenData.length;i++){%>
										<tr>
											<td><%=coupenData[i].coupenCode%></td>
											<td>-<%=coupenData[i].discount%>%</td>
										</tr>
										<% }%>

										<% }%>
									
									<tr>
										<td>Total TO Pay</td>
										<td><%=totalToPay%>	</td>
									</tr>
								</tbody>
							</table>

							<!-- Add this to your checkout section -->
<!-- Add this to your checkout section -->
<!-- Add this to your checkout section -->
<div class="payment-options">
	<h3>Select Payment Method:</h3>
	<div class="payment-option">
	  <input type="radio" id="cod" name="paymentMethod" value="cod">
	  <label for="cod">Cash on Delivery (COD)</label>
	</div>
	<div class="payment-option">
	  <input type="radio" id="online" name="paymentMethod" value="online">
	  <label for="online">Online Payment</label>
	</div>
	<div class="payment-option">
	  <input type="radio" id="wallet" name="paymentMethod" value="wallet">
	  <label for="wallet">Wallet</label>
	</div>
</div>
  
  
  
							<a href="/place-order" class="boxed-btn" id="placeOrderButton">Place Order</a>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- end check out section -->
	
		<style>
			/* CSS for the button */
			.boxed-btnn{
			float: right;
			
		
			padding: 10px 20px;
			
			
		}
		

		</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
		<script>
			$(document).ready(function () {
  $("#changeAddressButton").click(function () {
    $("#addressModal").modal("show"); // Display the modal when the button is clicked
  });
});

		</script>
		<script>
			document.getElementById('openAddAddressModal').addEventListener('click', function () {
				$('#addressModal').modal('hide'); // Close the address modal
			});
		</script>
		
<script>
	document.addEventListener('DOMContentLoaded', function () {
    const radioButtons = document.querySelectorAll('input[type="radio"][name="selectedAddress"]')
	console.log("radioButtons:",radioButtons);
    radioButtons.forEach(function (radioButton) { // Use forEach, not foreach
        radioButton.addEventListener('change', function () {
            const selectedAddressId = radioButton.value;
            // The rest of your code remains the same
            fetch(`/setasDefault?id=${selectedAddressId}&source=checkout`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
            })
            .then((response) => response.json())
            .then((data) => {
                console.log(data.message);
            })
            .catch((error) => {
                console.error(error);
            });
        });
    });
});

		

</script>

<script>
	document.addEventListener('DOMContentLoaded', function () {
		const placeOrderButton = document.getElementById('placeOrderButton');

		placeOrderButton.addEventListener('click', function (event) {
			event.preventDefault(); 

			// Get the selected payment method
			const paymentMethod = document.querySelector('input[type="radio"][name="paymentMethod"]:checked').value;

			console.log("paymentMethod:", paymentMethod);

			fetch('/place-order', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({
					paymentMethod: paymentMethod,
				}),
			})
			.then(response => response.json()) 
			.then(data => {
                
				if(data.success){
					console.log("Response from the server:", data.message);
                     
					window.location.href = '/orderSuccess'; 
                    
				} else{
					console.error('Error:', data.message);
				}
				
				
				
			})
			.catch(error => {
				console.error('Error:', error);
			});
		});
	});
</script>



		


		

		<%- include('../layouts/footer')%>